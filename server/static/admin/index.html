<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Feedback Bot</title>
  <link rel="stylesheet" href="/static/admin/admin.css?v=2.5">
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ¯ Dashboard Admin - Sistema di Feedback Bot</h1>
      <p>Rivedi le conversazioni, fornisci feedback e migliora le risposte del bot</p>
    </header>

    <nav class="tabs">
      <button class="tab active" onclick="switchTab('conversations')">ğŸ’¬ Conversazioni</button>
      <button class="tab" onclick="switchTab('analytics')">ğŸ“Š Statistiche</button>
      <button class="tab" onclick="switchTab('approved')">â­ Risposte Approvate</button>
    </nav>

    <!-- Conversations Tab -->
    <div id="conversations-tab" class="tab-content active">
      <div class="summary-banner" id="summary-banner">
        <!-- Summary will be loaded here -->
      </div>
      
      <div class="filters-modern">
        <div class="filters-row">
          <div class="filter-item">
            <label class="filter-label">ğŸ“± Canale</label>
            <select id="channel-filter" class="filter-select" onchange="loadConversations()">
              <option value="">Tutti i Canali</option>
              <option value="web">ğŸ’» Web</option>
              <option value="phone">ğŸ“ Telefono</option>
            </select>
          </div>
          
          <div class="filter-item">
            <label class="filter-label">ğŸ“… Data Inizio</label>
            <input type="date" id="start-date" class="filter-input" onchange="loadConversations()" />
          </div>
          
          <div class="filter-item">
            <label class="filter-label">ğŸ“… Data Fine</label>
            <input type="date" id="end-date" class="filter-input" onchange="loadConversations()" />
          </div>
        </div>
        
        <div class="filters-row">
          <div class="filter-toggle">
            <label class="toggle-container">
              <input type="checkbox" id="needs-review-filter" onchange="loadConversations()" checked />
              <span class="toggle-slider"></span>
              <span class="toggle-label">ğŸ¤– Mostra solo conversazioni segnalate dall'AI</span>
            </label>
          </div>
          
          <div class="filter-actions">
            <button onclick="loadConversations()" class="btn-secondary">ğŸ”„ Aggiorna</button>
            <button onclick="evaluateAllConversations()" class="btn-primary">ğŸ¤– Valuta Tutte</button>
          </div>
        </div>
      </div>

      <div id="conversations-list" class="conversations-list">
        <!-- Conversations will be loaded here -->
      </div>

      <div class="pagination">
        <button id="prev-page" onclick="previousPage()">â† Precedente</button>
        <span id="page-info">Pagina 1</span>
        <button id="next-page" onclick="nextPage()">Successiva â†’</button>
      </div>
    </div>

    <!-- Analytics Tab -->
    <div id="analytics-tab" class="tab-content">
      <h2>ğŸ“Š Metriche Dashboard</h2>
      <div id="analytics-content" class="analytics-grid">
        <!-- Analytics will be loaded here -->
      </div>
    </div>

    <!-- Approved Responses Tab -->
    <div id="approved-tab" class="tab-content">
      <h2>â­ Risposte Approvate per l'Apprendimento</h2>
      <div id="approved-content">
        <!-- Approved responses will be loaded here -->
      </div>
    </div>
  </div>

  <!-- Conversation Detail Modal -->
  <div id="conversation-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2>Dettagli Conversazione</h2>
      <div id="conversation-detail"></div>
    </div>
  </div>

  <!-- Inline Feedback Form Template (hidden, will be cloned) -->
  <template id="feedback-form-template">
    <div class="inline-feedback-form">
      <h4>ğŸ’¬ Fornisci Feedback</h4>
      
      <label>Valutazione:</label>
      <div class="rating">
        <button type="button" onclick="setInlineRating(this, 1)">â­</button>
        <button type="button" onclick="setInlineRating(this, 2)">â­â­</button>
        <button type="button" onclick="setInlineRating(this, 3)">â­â­â­</button>
        <button type="button" onclick="setInlineRating(this, 4)">â­â­â­â­</button>
        <button type="button" onclick="setInlineRating(this, 5)">â­â­â­â­â­</button>
      </div>
      <input type="hidden" class="selected-rating" value="3">
      
      <label>Tag:</label>
      <div class="tags">
        <label><input type="checkbox" value="helpful"> Utile</label>
        <label><input type="checkbox" value="accurate"> Accurata</label>
        <label><input type="checkbox" value="wrong_info"> Info Errata</label>
        <label><input type="checkbox" value="tone_issue"> Problema di Tono</label>
        <label><input type="checkbox" value="context_lost"> Contesto Perso</label>
        <label><input type="checkbox" value="excellent"> Eccellente</label>
      </div>
      
      <label>Commento Admin:</label>
      <textarea class="admin-comment" rows="3" placeholder="Il tuo feedback..."></textarea>
      
      <label>Risposta Corretta (opzionale):</label>
      <textarea class="corrected-response" rows="4" placeholder="Fornisci una risposta migliore..."></textarea>
      
      <div class="feedback-actions">
        <button onclick="submitInlineFeedback(this)" class="submit-btn">ğŸ’¾ Invia Feedback</button>
        <button onclick="approveInlineResponse(this)" class="approve-btn">âœ… Approva per Apprendimento</button>
        <button onclick="closeInlineFeedback(this)" class="cancel-btn">âœ–ï¸ Annulla</button>
      </div>
    </div>
  </template>

  <script src="/static/admin/admin.js?v=2.5"></script>
</body>
</html>
